
pool: hosted-linux

pr: none

trigger:
  branches:
    include:
      - master
  paths:
    include:
      - src/Auth.Models
      - src/Auth.ApiConsumer
      - pipelines/Nuget.yaml


parameters:
  - name: projects
    type: object
    default:
    - Auth.Models
    - Auth.ApiConsumer

stages:

  - stage: 
    displayName: Build

    jobs:

      - job: Compile
        steps:

        # - task: DotNetCoreCLI@2
        #   inputs:
        #     command: pack
        #     configuration: release
        #     workingDirectory: src
        #     modifyOutputPath: false
        #     packDirectory: nugets
        #     packagesToPack: $(projects)
        #     arguments: -o nugets
        #     projects: $(projects)

        - ${{ each project in parameters.projects }}:
          - script: |
              dotnet pack ${{ project }} \
              -c release \
              -o $(System.DefaultWorkingDirectory)/nugets
            workingDirectory: src
            displayName: Packing ${{ project }}
        

        - publish: nugets
          artifact: packed

  - stage: Deploy
    jobs:
      - job: Push

        steps:

        - download: current

        - checkout: none

        - task: NuGetAuthenticate@1

        - task: NuGetCommand@2
          inputs:
            command: push
            packagesToPush: $(Pipeline.Workspace)/**/*.nupkg
            nuGetFeedType: internal
            publishVstsFeed: https://pkgs.dev.azure.com/nevillenazerane/Nugets/_packaging/Development_Projects/nuget/v3/index.json